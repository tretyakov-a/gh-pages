(()=>{"use strict";const t="https://raw.githubusercontent.com/tretyakov-a/online-store/main";var e,s,r;!function(t){t.APP_LOAD="onProductsLoad",t.PRODUCTS_LIST_UPDATE="onProductsListUpdate",t.FILTERS_CHANGE="onFiltersChange",t.FILTER_CHANGE="onFilterChange",t.TRY_ADD_TO_CART="onTryAddToCart",t.ADD_TO_CART="onAddToCart",t.CHANGE_DISPLAY_OPTION="onChangeDisplayOption",t.CHANGE_SORT="onChangeSort",t.SHOW_ALERT="onShowAlert"}(e||(e={})),function(t){t.PRICE="price",t.WEIGHT="weight",t.BRAND="brand",t.COLOR="color",t.MOBILE_CONTROL="mobileControl",t.CAMERA_INCLUDED="cameraIncluded",t.SEARCH="search",t.YEAR="year"}(s||(s={})),function(t){t.LIST="list",t.GRID="grid"}(r||(r={}));const n=r.GRID,i=t=>{if(!(t&&t instanceof HTMLElement))throw new TypeError;return t},a=t=>e=>i(t.querySelector(e));function o(t,e){let s=-1;return r=>{clearTimeout(s),s=window.setTimeout((()=>{e.call(this,r)}),t)}}class c{constructor(t){const{root:e}=t;this.component=t.component,this.root=e||null,this._root=null,this.isLoading=!1}getRoot(){return null===this._root?"string"!=typeof this.root?i(this.root):a(document)(this.root):this._root}afterRender(t,e=-1){this._root="string"==typeof this.root?-1===e?a(t.getRoot())(this.root):a(t.getRoot())(`${this.root}:nth-child(${e+1})`):this.root,null===this.root&&(this.root=t.getRoot())}renderChild(...t){return this.component.renderChild(...t)}render(t){return void 0!==t&&"string"==typeof t?t:""}}function l(t,{data:e,forceLog:s=!1}={}){s&&console.log(`%c${t}`,"color: blue;",Object.getPrototypeOf(this).constructor.name,this.viewConstructor?.name,e||"")}class h extends class{constructor(t){this.emmiter=t,this.listenersForRemove=[]}emit(t,e){this.emmiter?.emit(t,e)}on(t,e){this.emmiter&&this.listenersForRemove.push(this.emmiter.on(t,e))}}{constructor(t){super(t.emmiter),this.name=t.name||"",this.id=-1,this.parent=t.parent||null,this._components={},this.handlers=t.handlers||{},this.viewConstructor=t.viewConstructor||c,this.view=new this.viewConstructor({...t.viewOptions,component:this}),l.call(this,"COMPONENT CONSTRUCTING END")}renderChild(...[t,e,s={}]){l.call(this,"COMPONENT ADD CHILD:",{data:`'${t}'[${e.name}]`});const r=new e({...s,name:t,parent:this,emmiter:this.emmiter}),n=this._components[t];return void 0!==n?Array.isArray(n)?(r.id=n.length,n.push(r)):(n.id=0,r.id=1,this._components[t]=[n,r]):this._components[t]=r,r.render(s.data)}isArrayItem(){return-1!==this.id}update(t){this.parent?.updateChild(this,t)}updateChild(t,e){l.call(this,"UPDATING",{data:`CHILD: ${t.name}`});const s=t.getRoot(),r=t.render(e);s.insertAdjacentHTML("afterend",r),s.parentNode?.removeChild(s),t.afterRender()}getChild(t){return this._components[t]}getComponent(t){return this._components[t]}getComponents(){return this._components}getRoot(){return i(this.view.getRoot())}onLoadingStart(){this.view.isLoading=!0}onLoadingEnd(t){this.view.isLoading=!1,this.update(t)}render(t){return l.call(this,"COMPONENT RENDER: "),Object.keys(this._components).length>0&&this.removeChildrens(),this.view.render(t)}afterRender(){l.call(this,"COMPONENT AFTER RENDER",{data:this.parent?.getRoot()}),this.view.afterRender(this.parent,this.id),Object.keys(this._components).forEach((t=>{const e=this._components[t];Array.isArray(e)?e.forEach((t=>t.afterRender())):e.afterRender()}))}removeChildrens(){Object.keys(this._components).forEach((t=>{const e=this._components[t];Array.isArray(e)?e.forEach((t=>t.onDestroy())):e.onDestroy()})),this._components={}}onDestroy(){this.listenersForRemove.forEach((t=>t.call(null))),this.removeChildrens()}}var d;!function(t){t.PRICE="price",t.RATING="rating",t.YEAR="year",t.BRAND="brand",t.COLOR="color",t.WEIGHT="weight",t.MOBILE_CONTROL="mobileControl",t.CAMERA_INCLUDED="cameraIncluded",t.TITLE="title"}(d||(d={}));const u={[d.PRICE]:t=>t.price,[d.RATING]:t=>t.rating,[d.YEAR]:t=>t.year,[d.BRAND]:t=>t.brand,[d.COLOR]:t=>t.props.classification?.specs.color?.value,[d.WEIGHT]:t=>Number.parseInt(t.props.dimensions?.specs.weight?.value||""),[d.MOBILE_CONTROL]:t=>t.props.mobileSupport?.specs.mobileControl?.value,[d.CAMERA_INCLUDED]:t=>t.props.camera?.specs.cameraIncluded?.value,[d.TITLE]:t=>t.title};var p;!function(t){t.TITLE_ASC="titleAsc",t.TITLE_DESC="titleDesc",t.PRICE_ASC="priceAsc",t.PRICE_DESC="priceDesc",t.RATING_ASC="ratingAsc",t.RATING_DESC="ratingDesc"}(p||(p={}));const _=t=>"asc"===t?1:-1,g=t=>"asc"===t?-1:1,m=t=>e=>s=>{s.sort(((s,r)=>{const n=t(s),i=t(r);if(void 0!==n&&void 0!==i){if(n>i)return _(e);if(n<i)return g(e)}else void 0!==n&&void 0===i&&_(e),null==n&&void 0!==i&&g(e);return 0}))},v=m(u[d.TITLE]),f=m(u[d.PRICE]),C=m(u[d.RATING]),E={[p.TITLE_ASC]:["По имени (А-Я)",v("asc")],[p.TITLE_DESC]:["По имени (Я-А)",v("desc")],[p.PRICE_ASC]:["По возрастанию цены",f("asc")],[p.PRICE_DESC]:["По убыванию цены",f("desc")],[p.RATING_ASC]:["По возрастанию рейтинга",C("asc")],[p.RATING_DESC]:["По убыванию рейтинга",C("desc")]};class I extends c{constructor(t){super({...t,root:".rsschool-logo"})}render(){return super.render('\n      <a class="rsschool-logo" href="https://rs.school/js/" title="https://rs.school/js/" target="_blank">\n        <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 552.8 205.3">\n          <style>.st0{fill:var( --text-color-1)}.st1{clip-path:url(#SVGID_2_)}.st2{clip-path:url(#SVGID_4_)}.st3{clip-path:url(#SVGID_6_)}.st4{clip-path:url(#SVGID_8_)}.st5{fill:var(--text-color-1);stroke-width:4;stroke-miterlimit:10}.st6{clip-path:url(#SVGID_8_)}.st6,.st7{fill:none;stroke-width:4;stroke-miterlimit:10}.st8,.st9{clip-path:url(#SVGID_10_)}.st9{fill:none;stroke-width:4;stroke-miterlimit:10}</style>\n          <title>rs_school_js</title>\n          <path class="logo-path" d="M285.4 68l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.9 3.6 6.9 5.4 12.2 5.4 3.9 0 7-.9 9.1-2.8 2-1.5 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.1-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4 6 4.2 9.6 11 10.7 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8s-5.3-2.8-9.2-2.8c-3.2 0-5.6.7-7.2 2-1.5 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.5 13.3 0 5.6-1.6 11.2-4.8 15.9-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8S286.1 77 285.4 68zM6.3 97.6V8.2h46.1c8.5 0 15.1.7 19.6 2.2 4.4 1.4 8.3 4.3 10.9 8.2 2.9 4.3 4.3 9.3 4.2 14.5.3 8.8-4.2 17.2-11.9 21.6-3 1.7-6.3 2.9-9.7 3.5 2.5.7 5 1.9 7.2 3.3 1.7 1.4 3.1 3 4.4 4.7 1.5 1.7 2.8 3.6 3.9 5.6l13.4 25.9H63L48.2 70.2c-1.9-3.5-3.5-5.8-5-6.9-2-1.4-4.4-2.1-6.8-2.1H34v36.3H6.3zM34 44.4h11.7c2.5-.2 4.9-.6 7.3-1.2 1.8-.3 3.4-1.3 4.5-2.8 2.7-3.6 2.3-8.7-1-11.8-1.8-1.5-5.3-2.3-10.3-2.3H34v18.1zM0 174.2l26.3-1.7c.6 4.3 1.7 7.5 3.5 9.8 2.8 3.6 6.9 5.5 12.2 5.5 3.9 0 7-.9 9.1-2.8 2-1.6 3.2-3.9 3.2-6.4 0-2.4-1.1-4.7-3-6.2-2-1.8-6.7-3.6-14.2-5.2-12.1-2.7-20.8-6.3-25.9-10.9-5.1-4.3-8-10.6-7.8-17.3 0-4.6 1.4-9.2 4-13 3-4.3 7.1-7.7 12-9.6 5.3-2.3 12.7-3.5 22-3.5 11.4 0 20.1 2.1 26.1 6.4s9.5 11 10.6 20.3l-26 1.5c-.7-4-2.1-6.9-4.4-8.8-2.2-1.9-5.3-2.8-9.2-2.7-3.2 0-5.6.7-7.2 2.1-1.6 1.2-2.5 3-2.4 5 0 1.5.8 2.9 2 3.8 1.3 1.2 4.4 2.3 9.3 3.3 12.1 2.6 20.7 5.2 26 7.9 5.3 2.7 9.1 6 11.4 9.9 2.4 4 3.6 8.6 3.6 13.2 0 5.6-1.7 11.1-4.8 15.8-3.3 4.9-7.9 8.7-13.3 11-5.7 2.5-12.9 3.8-21.5 3.8-15.2 0-25.7-2.9-31.6-8.8-5.9-6-9.2-13.4-10-22.4z"/>\n          <path class="logo-path" d="M133 167.2l24.2 7.3c-1.3 6.1-4 11.9-7.7 17-3.4 4.5-7.9 8-13 10.3-5.2 2.3-11.8 3.5-19.8 3.5-9.7 0-17.7-1.4-23.8-4.2-6.2-2.8-11.5-7.8-16-14.9-4.5-7.1-6.7-16.2-6.7-27.3 0-14.8 3.9-26.2 11.8-34.1s19-11.9 33.4-11.9c11.3 0 20.1 2.3 26.6 6.8 6.4 4.6 11.2 11.6 14.4 21l-24.4 5.4c-.6-2.1-1.5-4.2-2.7-6-1.5-2.1-3.4-3.7-5.7-4.9-2.3-1.2-4.9-1.7-7.5-1.7-6.3 0-11.1 2.5-14.4 7.6-2.5 3.7-3.8 9.6-3.8 17.6 0 9.9 1.5 16.7 4.5 20.4 3 3.7 7.2 5.5 12.7 5.5 5.3 0 9.3-1.5 12-4.4 2.7-3.1 4.7-7.4 5.9-13zm56.5-52.8h27.6v31.3h30.2v-31.3h27.8v89.4h-27.8v-36.2h-30.2v36.2h-27.6v-89.4z"/>\n          <path class="logo-path" d="M271.3 159.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.3 4 34.4 12S364 144 364 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8s4.9-10.8 4.9-20.8c0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5zm93.4-.1c0-14.6 4.1-26 12.2-34.1 8.1-8.1 19.5-12.2 34-12.2 14.9 0 26.4 4 34.4 12S485 144 485 158.4c0 10.5-1.8 19-5.3 25.7-3.4 6.6-8.7 12-15.2 15.6-6.7 3.7-15 5.6-24.9 5.6-10.1 0-18.4-1.6-25-4.8-6.8-3.4-12.4-8.7-16.1-15.2-4.1-7-6.2-15.7-6.2-26.2zm27.6.1c0 9 1.7 15.5 5 19.5 3.3 3.9 7.9 5.9 13.7 5.9 5.9 0 10.5-1.9 13.8-5.8 3.3-3.9 4.9-10.8 4.9-20.8 0-8.4-1.7-14.6-5.1-18.4-3.4-3.9-8-5.8-13.8-5.8-5.1-.2-10.1 2-13.4 5.9-3.4 3.9-5.1 10.4-5.1 19.5z"/>\n          <path class="logo-path" d="M482.1 114.4h27.6v67.4h43.1v22H482v-89.4z"/>\n          <ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_1_" class="st0" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" overflow="visible"/></clipPath><g class="st1"><path transform="rotate(-37.001 420.82 68.353)" class="st0" d="M330.9-14.2h179.8v165.1H330.9z"/><g id="Layer_2_1_"><defs><path id="SVGID_3_" transform="rotate(-37.001 420.82 68.353)" d="M330.9-14.2h179.8v165.1H330.9z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" overflow="visible"/></clipPath><g id="Layer_1-2" class="st2"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st0" cx="420.5" cy="67.9" rx="63" ry="51.8"/><defs><ellipse id="SVGID_5_" transform="rotate(-37.001 420.46 67.88)" cx="420.5" cy="67.9" rx="63" ry="51.8"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" overflow="visible"/></clipPath><g class="st3"><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_7_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" overflow="visible"/></clipPath><g class="st4"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st6" d="M357.8 17h125.9v103.7H357.8z"/><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/><path transform="rotate(-37 420.799 68.802)" class="st0" d="M357.8 17h125.9v103.7H357.8z"/><defs><path id="SVGID_9_" transform="rotate(-37 420.799 68.802)" d="M357.8 17h125.9v103.7H357.8z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" overflow="visible"/></clipPath><g class="st8"><ellipse transform="rotate(-37.001 420.46 67.88)" class="st5" cx="420.5" cy="67.9" rx="63" ry="51.8"/></g><path transform="rotate(-37 420.799 68.802)" class="st9" d="M357.8 17h125.9v103.7H357.8z"/><path transform="rotate(-37.001 420.82 68.353)" class="st7" d="M330.9-14.2h179.8v165.1H330.9z"/></g><ellipse transform="rotate(-37.001 420.46 67.88)" class="st7" cx="420.5" cy="67.9" rx="63" ry="51.8"/>\n          <path class="st1" d="M392.4 61.3l10-7 12.3 17.5c2.1 2.8 3.7 5.8 4.9 9.1.7 2.5.5 5.2-.5 7.6-1.3 3-3.4 5.5-6.2 7.3-3.3 2.3-6.1 3.6-8.5 4-2.3.4-4.7 0-6.9-1-2.4-1.2-4.5-2.9-6.1-5.1l8.6-8c.7 1.1 1.6 2.1 2.6 2.9.7.5 1.5.8 2.4.8.7 0 1.4-.3 1.9-.7 1-.6 1.7-1.8 1.6-3-.3-1.7-1-3.4-2.1-4.7l-14-19.7zm30 11.1l9.1-7.2c1 1.2 2.3 2.1 3.7 2.6 2 .6 4.1.2 5.8-1.1 1.2-.8 2.2-1.9 2.6-3.3.6-1.8-.4-3.8-2.2-4.4-.3-.1-.6-.2-.9-.2-1.2-.1-3.3.4-6.4 1.7-5.1 2.1-9.1 2.9-12.1 2.6-2.9-.3-5.6-1.8-7.2-4.3-1.2-1.7-1.8-3.7-1.9-5.7 0-2.3.6-4.6 1.9-6.5 1.9-2.7 4.2-5 7-6.8 4.2-2.9 7.9-4.3 11.1-4.3 3.2 0 6.2 1.5 9 4.6l-9 7.1c-1.8-2.3-5.2-2.8-7.5-1l-.3.3c-1 .6-1.7 1.5-2.1 2.6-.3.8-.1 1.7.4 2.4.4.5 1 .9 1.7.9.8.1 2.2-.3 4.2-1.2 5-2.1 8.8-3.3 11.4-3.7 2.2-.4 4.5-.2 6.6.7 1.9.8 3.5 2.2 4.6 3.9 1.4 2 2.2 4.4 2.3 6.9.1 2.6-.6 5.1-2 7.3-1.8 2.7-4.1 5-6.8 6.8-5.5 3.8-10 5.4-13.6 4.8-3.9-.6-7.1-2.6-9.4-5.5z"/></g></g></g>\n        </svg>\n      </a>\n    ')}}class L extends c{constructor(t){super({...t,root:".footer"})}render(){return super.render(`\n      <div class="footer">\n        <div class="footer__container container">\n          ${this.renderChild("rssLogo",h,{viewConstructor:I})}\n          <div class="footer__year">\n            2022\n          </div>\n          <a class="footer__github-link" href="https://github.com/tretyakov-a" title="GitHub" target="_blank">\n            <i class="fab fa-github"></i>\n            tretyakov-a\n          </a>\n        </div>\n      </div>\n    `)}}class R extends c{constructor(t){super({...t,root:".lds-ellipsis"})}render(){return super.render('\n      <div class="lds-ellipsis">\n        <div></div>\n        <div></div>\n        <div></div>\n        <div></div>\n      </div>\n    ')}}class A extends c{render(t){const e=this.isLoading?this.renderChild("spinner",h,{viewConstructor:R}):"string"==typeof t?t:"";return"function"==typeof t?t(e):e}}class T extends A{constructor(t){super({...t,root:".header__cart"})}renderCart(t){return`\n      <div class="cart">\n        <div class="cart__total">${t}</div>\n        <a class="button button_special cart__link" href="#cart">Корзина</a>\n      </div>`}render(t){let e="";return void 0!==t&&(e=this.renderCart(t.productsAmount)),super.render((t=>`\n      <div class="header__cart">\n        ${""!==t?t:e}\n      </div>\n    `))}}class S extends h{constructor(t){super({...t,viewConstructor:T}),this.handleAddToCart=t=>{this.productIds.push(t.detail),this.update({productsAmount:this.productIds.length})},this.handleDataLoad=t=>{this.productIds=[...t.detail.state.productInCartIds],this.onLoadingEnd({productsAmount:this.productIds.length})},this.productIds=[],this.on(e.ADD_TO_CART,this.handleAddToCart),this.on(e.APP_LOAD,this.handleDataLoad),this.onLoadingStart()}render(t){return super.render(t)}}class x extends c{constructor(t){super({...t,root:".header"})}render(){return super.render(`\n      <div class="header">\n        <div class="header__container container">\n          <a class="header__logo logo" href="#">\n            <h1>QuadroShop</h1>\n          </a>\n          ${this.renderChild("cartBtn",S)}\n        </div>\n      </div>\n    `)}}const k={[r.LIST]:'\n    <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M10 7V11H22V7H10ZM10 21H22V17H10V21ZM10 16H22V12H10V16ZM5 11H9V7H5V11ZM5 21H9V17H5V21ZM5 16H9V12H5V16Z"/>\n    </svg>   \n  ',[r.GRID]:'\n    <svg width="28" height="28" viewBox="0 0 28 28" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M5 13H13V5H5V13ZM5 23H13V15H5V23ZM15 23H23V15H15V23ZM15 5V13H23V5"/>\n    </svg>\n  '};class w extends c{constructor(t){super({...t,root:".products__display-options"})}renderButtons({inputName:t,values:e,checked:s}){return e.map((e=>`<label class="radio-group__item radio">\n          <input type="radio" name="${t}" value="${e}" checked="${e===n}">\n          <div class="radio__button">\n            ${k[e]}        \n          </div>\n        </label>`)).join("")}render(t){return super.render(`\n      <div class="products__display-options">\n        <div class="radio-group">\n          <form class="radio-group__form">\n            ${this.renderButtons(t)}\n          </form>\n        </div>\n      </div>\n    `)}}class y extends h{constructor(t){super({...t,viewConstructor:w}),this.onChange=t=>{const s=t.currentTarget;if(null!==s&&s instanceof HTMLFormElement){const t=new FormData(s).get(y.nameAttrValue);this.emit(e.CHANGE_DISPLAY_OPTION,t)}}}render(){return super.render({inputName:y.nameAttrValue,values:Object.values(r),checked:n})}afterRender(){super.afterRender(),a(this.getRoot())(".radio-group__form").addEventListener("change",this.onChange)}}y.nameAttrValue="display-options";class D extends c{constructor(t){super({...t,root:".products__sort"})}renderOptions(){return Object.entries(E).map((([t,[e]])=>`<option value="${t}">${e}</option>`)).join("")}render(t){return super.render(`\n      <div class="products__sort">\n        <div class="select">\n          <div class="select__title">Сортировать</div>\n          <select class="select__input" name="products-sort" value="${t?.value||p.TITLE_ASC}">\n            ${this.renderOptions()}\n          </select>\n        </div>\n      </div>\n    `)}}class b extends h{constructor(t){super({...t,viewConstructor:D}),this.handleAppLoad=({detail:{state:t}})=>{this.inputEl&&(this.inputEl.value=t.sort)},this.onChange=()=>{this.inputEl&&this.emit(e.CHANGE_SORT,this.inputEl.value)},this.inputEl=null,this.on(e.APP_LOAD,this.handleAppLoad)}afterRender(){super.afterRender();const t=a(this.getRoot())("select");t instanceof HTMLSelectElement&&(this.inputEl=t,this.inputEl.addEventListener("change",this.onChange))}}class $ extends c{constructor(t){super({...t,root:".products__header"})}render(){return super.render(`\n      <div class="products__header">\n        ${this.renderChild("productsSort",b)}\n        ${this.renderChild("productsDisplayOptions",y)}\n      </div>\n    `)}}class O extends c{constructor(t){super({...t,root:".product__add-to-curt"})}render(t){const e=t.isInCart?'<span class="product__in-cart">В корзине</span>':'<button class="button button_icon">\n          <i class="fa-solid fa-cart-plus"></i>\n        </button>';return super.render(`<div class="product__add-to-curt">${e}</div>`)}}class N extends h{constructor(){super(...arguments),this.onClick=t=>{this.handlers?.onClick(t)}}afterRender(){super.afterRender(),this.getRoot().querySelector("button")?.addEventListener("click",this.onClick)}}class H extends N{constructor(t){if(!t.data)throw TypeError();super({...t,viewConstructor:O}),this.handleAddToCart=t=>{const e=t.detail;this.productId===e&&this.update({isInCart:!0})},this.onClick=async()=>{this.emit(e.TRY_ADD_TO_CART,this.productId)},this.productId=t.data.product.id,this.on(e.ADD_TO_CART,this.handleAddToCart)}}class P extends c{constructor(t){super({...t,root:".product__rating"})}getStarStyle(t){if(100===t)return"";const e=`${t}%`;return`style="background: linear-gradient(90deg, #ffa500 ${e}, #ffffff ${e});"`}renderStars(t){const e=Number.parseFloat(t);return Array(5).fill(0).map(((t,s)=>{if(s+1<=e)return 100;const r=Math.trunc(100*(1-(s+1-e)));return r<0?0:r})).map((t=>`\n        <span class="product-rating__star">\n          <span class="product-rating__start-inner" ${this.getStarStyle(t)}></span>\n        </span>\n      `)).join("")}render(t){return super.render(`\n      <div class="product__rating product-rating">\n        <span class="product-rating__stars">\n          ${this.renderStars(t.rating)}\n        </span>\n        <span class="product-rating__value">${t.rating}</span>\n      </div>\n    `)}}class M extends c{constructor(t){super({...t,root:".products-list__item"})}render(e){const{product:{title:s,price:r,rating:n,imgs:i}}=e,a=`${t}/${i[0]}`;return super.render(`\n      <li class="products-list__item product">\n        <div class="product__img">\n          <img\n            src="${a}"\n            alt="${s}">\n        </div>\n        <div class="product__description">\n          <h3 class="product__title">${s}</h3>\n          <p class="product__extra">\n            ${e.product.props.additionalInfo?.specs.equipment?.value}\n            ${e.product.props.additionalInfo?.specs.extra?.value}\n          </p>\n          <div class="product__buy">\n            <div class="product__price">${r} ₽</div>\n            ${this.renderChild("addToCart",H,{data:e})}\n          </div>\n          <div class="product__info">\n            ${this.renderChild("productRating",h,{viewConstructor:P,data:{rating:n}})}\n            <label class="product__compare checkbox">\n              <input type="checkbox" name="product-compare">\n              <span class="checkbox__check"></span>\n              <span class="checkbox__title">Compare</span>\n            </label>\n          </div>\n        </div>\n      </li>\n    `)}}class V extends A{constructor(t){super({...t,root:".products__list"})}renderItems(t){const{products:e,state:{productInCartIds:s}}=t;return e.map((t=>this.renderChild("productsListItem",h,{data:{product:t,isInCart:s.includes(t.id)},viewConstructor:M}))).join("")}render(t){let e="";if(void 0!==t){const s=V.className,{error:r,products:n}=t,i=`${s}_${t.displayOption}`;e=r?"Ошибка загрузки товаров":0===n.length?'<p class="products__empty">Товары не найдены! Попробуйте изменить критерии фильтрации.</p>':`<ul class="${s} ${i}">${this.renderItems(t)}</ul>`}return super.render((t=>`\n      <div class="products__list">\n        ${""!==t?t:e}\n      </div>\n    `))}}V.className="products-list";class G extends h{constructor(t){super({...t,viewConstructor:V}),this.handleAppLoad=t=>{const{displayOption:e}=this;this.onLoadingEnd({...t.detail,displayOption:e})},this.handleProductsListUpdate=t=>{const{displayOption:e}=this;this.update({...t.detail,displayOption:e})},this.onChangeDisplayOption=t=>{const e=this.displayOption;this.displayOption=t.detail;const s=V.className,r=this.getRoot().querySelector(`.${s}`);null!==r&&r.classList.replace(`${s}_${e}`,`${s}_${this.displayOption}`)},this.displayOption=n,this.onLoadingStart(),this.on(e.APP_LOAD,this.handleAppLoad),this.on(e.PRODUCTS_LIST_UPDATE,this.handleProductsListUpdate),this.on(e.CHANGE_DISPLAY_OPTION,this.onChangeDisplayOption)}}class F extends h{constructor(t){const{data:e}=t;if(void 0===e)throw new TypeError;super(t),this.getFilterData=t=>({}),this.name=e.name,this.title=e.title,this.propPicker=Q[e.name][2]}check(t){return void 0!==t&&void 0!==this.propPicker(t)}getName(){return this.name}getState(){return{}}}class B extends c{constructor(t){super({...t,root:".checkbox-list"})}renderItems(t){const{inputName:e,values:s,checkedValues:r}=t;return Object.keys(s).map((t=>`\n        <li class="checkbox-list__item">\n          <label class="checkbox">\n            <input type="checkbox" name="${e}" value="${t}" ${r.includes(t)?"checked":""}>\n            <span class="checkbox__check"></span>\n            <span class="checkbox__title">${t} (${s[t]})</span>\n          </label>\n        </li>\n      `)).join("")}render(t){return super.render(`\n    <ul class="checkbox-list">\n      ${this.renderItems(t)}\n    </ul>\n  `)}}class z extends F{constructor(t){super({...t,viewConstructor:B}),this.handleChange=()=>{if(!this.checkboxes)return;const t=[...this.checkboxes].reduce(((t,e)=>e instanceof HTMLInputElement&&e.checked?[...t,e.value]:t),[]);this.checkedValues=[...t],this.emit(e.FILTER_CHANGE)},this.getFilterData=t=>t.reduce(((t,e)=>{const s=this.propPicker(e);return s&&(t[s]=t[s]?t[s]+1:1),t}),{});const{data:s}=t;if(void 0===s)throw new TypeError;this.checkedValues=s.state?.checkedValues||[],this.values=this.getFilterData(s.products),this.checkboxes=null}render(){const{values:t,checkedValues:e}=this;return super.render({inputName:this.name,values:t,checkedValues:e})}afterRender(){super.afterRender(),this.checkboxes=this.getRoot().querySelectorAll(`input[name="${this.name}"]`),this.checkboxes.forEach((t=>{t.addEventListener("change",this.handleChange)}))}check(t){if(0===this.checkedValues.length)return!0;const e=String(this.propPicker(t));return this.checkedValues.includes(e)}getState(){return{checkedValues:this.checkedValues}}}class j extends c{constructor(t){super({...t,root:".range"})}renderInput(t,e,s){const{min:r,max:n,inputName:i}=t;return`\n      <input class="${s}"\n        name="${i}"\n        type="range"\n        min="${r}"\n        max="${n}"\n        value="${e}">`}render(t){const{min:e,max:s,left:r,right:n}=t;return super.render(`\n      <label class="range">\n        <span class="range__min">${e}</span>\n        <div class="range__container">\n          <div class="range__track">\n            <div class="range__track-inner"></div>\n          </div>\n          ${this.renderInput(t,r,"range__input-left range__input_top")}\n          ${this.renderInput(t,n,"range__input-right")}\n        </div>\n        <span class="range__max">${s}</span>\n      </label>\n    `)}}class U extends h{constructor(t){super({...t,viewConstructor:j}),this.handleChange=()=>{const{left:t,right:e}=this;this.handlers?.onChange({left:t,right:e})},this.handleLeftRangeFocus=()=>{this.leftInputEl?.classList.add("range__input_top"),this.rightInputEl?.classList.remove("range__input_top")},this.handleRightRangeFocus=()=>{this.leftInputEl?.classList.remove("range__input_top"),this.rightInputEl?.classList.add("range__input_top")},this.handleLeftRangeChange=t=>{const e=t.target;if(!(e instanceof HTMLInputElement))return;const s=Number(e.value);if(s>this.right)return e.value=String(this.right),t.preventDefault();this.left=s,i(this.minEl).textContent=`${s}`,this.setTrackWidth()},this.handleRightRangeChange=t=>{const e=t.target;if(!(e instanceof HTMLInputElement))return;const s=Number(e.value);if(s<this.left)return e.value=String(this.left),t.preventDefault();this.right=s,i(this.maxEl).textContent=`${s}`,this.setTrackWidth()},this.minEl=null,this.maxEl=null,this.trackEl=null,this.leftInputEl=null,this.rightInputEl=null;const{data:e}=t;if(!e)throw new TypeError;const{min:s,max:r,left:n,right:a}=e;this.min=s,this.max=r,this.left=n>=s&&n<=r?n:s,this.right=a>=s&&a<=r?a:r}afterRender(){super.afterRender();const t=a(this.getRoot());this.minEl=t(".range__min"),this.maxEl=t(".range__max"),this.trackEl=t(".range__track-inner"),this.leftInputEl=t(".range__input-left"),this.rightInputEl=t(".range__input-right"),this.leftInputEl.addEventListener("input",this.handleLeftRangeChange),this.rightInputEl.addEventListener("input",this.handleRightRangeChange),this.leftInputEl.addEventListener("focus",this.handleLeftRangeFocus),this.rightInputEl.addEventListener("focus",this.handleRightRangeFocus),this.leftInputEl.addEventListener("change",this.handleChange),this.rightInputEl.addEventListener("change",this.handleChange),this.setTrackWidth()}setTrackWidth(){const{min:t,max:e,left:s,right:r}=this,n=(s-t)/(e-t)*100,a=100-n-(e-r)/(e-t)*100;i(this.trackEl).style.left=`${n}%`,i(this.trackEl).style.width=`${a}%`}}class Y extends F{constructor(t){super(t),this.handleChange=t=>{if(!t)return;const{left:s,right:r}=t;s===this.left&&r===this.right||(this.left=s,this.right=r,this.emit(e.FILTER_CHANGE))},this.getFilterData=t=>{const e=t.map((t=>Number(this.propPicker(t))));return{min:Math.min(...e),max:Math.max(...e)}};const{data:s}=t;if(void 0===s)throw new TypeError;const{min:r,max:n}=this.getFilterData(s.products);this.left=s.state?.left||r,this.right=s.state?.right||n,this.min=r,this.max=n}check(t){const e=Number(this.propPicker(t));return e>=this.left&&e<=this.right}getState(){const{left:t,right:e}=this;return{left:t,right:e}}render(){const{left:t,right:e,min:s,max:r}=this;return this.renderChild("filterContent",U,{handlers:{onChange:this.handleChange},data:{inputName:this.name,min:s,max:r,left:t,right:e}})}}class W extends c{constructor(t){super({...t,root:".switch"})}render(t){const{inputName:e,checked:s,title:r,matchedProductsNumber:n}=t;return super.render(`\n      <div class="switch">\n        <label class="checkbox">\n          <input type="checkbox" name="${e}" ${s?"checked":""}>\n          <span class="checkbox__check"></span>\n          <span class="checkbox__title">${r} (${n})</span>\n        </label>\n      </div>\n    `)}}var Z;!function(t){t.YES="есть",t.NO="нет"}(Z||(Z={}));class q extends F{constructor(t){super({...t,viewConstructor:W}),this.handleChange=()=>{this.checkbox&&(this.checkbox instanceof HTMLInputElement&&(this.checked=this.checkbox.checked),this.emit(e.FILTER_CHANGE))},this.getFilterData=t=>t.reduce(((t,e)=>{const s=this.propPicker(e);return t+Number(s===Z.YES)}),0);const{data:s}=t;if(void 0===s)throw new TypeError;this.matchedProductsNumber=this.getFilterData(s.products),this.checked=s.state?.checked||!1,this.checkbox=null}render(){const{checked:t,title:e,name:s,matchedProductsNumber:r}=this;return super.render({checked:t,title:e,inputName:s,matchedProductsNumber:r})}afterRender(){super.afterRender(),this.checkbox=a(this.getRoot())(`input[name="${this.name}"]`),this.checkbox.addEventListener("change",this.handleChange)}check(t){return!this.checked||String(this.propPicker(t))===Z.YES===this.checked}getState(){return{checked:this.checked}}}class J extends c{constructor(t){super({...t,root:".search"})}render(t){const{inputName:e,value:s,title:r}=t;return super.render(`\n      <div class="search">\n        <input class="search__input text" type="text" name="${e}" value="${s}" placeholder="${r}">\n        <button class="search__clear">\n          <i class="fa-solid fa-xmark"></i>\n        </button>\n        <button class="search__submit">\n          <i class="fa-solid fa-magnifying-glass"></i>\n        </button>\n      </div>\n    `)}}const Q={[s.SEARCH]:["Поиск по названию",class extends F{constructor(t){super({...t,viewConstructor:J}),this.handleClear=()=>{this.toggleClearBtn(),this.value="",this.searchInput.value="",this.handleChange()},this.handleInput=t=>{const e=t.target;e instanceof HTMLInputElement&&this.value!==e.value&&(this.value=e.value,""===this.value?this.handleClear():(!this.showClearBtn&&this.toggleClearBtn(),this.handleChange()))},this.handleChange=()=>{this.emit(e.FILTER_CHANGE)};const{data:s}=t;if(void 0===s)throw new TypeError;this.value=s.state?.value||"",this.searchInput=null,this.showClearBtn=""===this.value}render(){const{title:t,name:e,value:s}=this;return super.render({title:t,inputName:e,value:s})}afterRender(){super.afterRender(),this.toggleClearBtn();const t=a(this.getRoot())(`input[name="${this.name}"]`);t instanceof HTMLInputElement&&(t.addEventListener("input",o.call(this,200,this.handleInput)),this.searchInput=t),a(this.getRoot())(".search__clear").addEventListener("click",this.handleClear),a(this.getRoot())(".search__submit").addEventListener("click",this.handleChange)}toggleClearBtn(){this.showClearBtn=!this.showClearBtn;const t=this.showClearBtn?"add":"remove";this.getRoot().classList[t]("search_show-clear")}check(t){return""===this.value||String(this.propPicker(t)).toLowerCase().includes(this.value.toLowerCase())}getState(){return{value:this.value}}},u[d.TITLE],!1],[s.CAMERA_INCLUDED]:["Наличие камеры в комплекте",q,u[d.CAMERA_INCLUDED],!1],[s.MOBILE_CONTROL]:["Управление со смартфона",q,u[d.MOBILE_CONTROL],!1],[s.YEAR]:["Год выпуска",z,u[d.YEAR]],[s.BRAND]:["Бренд",z,u[d.BRAND]],[s.COLOR]:["Цвет",z,u[d.COLOR]],[s.PRICE]:["Цена (₽)",Y,u[d.PRICE]],[s.WEIGHT]:["Полетная масса (ПМ) (гр.)",Y,u[d.WEIGHT]]};class K extends c{constructor(t){super({...t,root:".filters-list__item"})}render(t){const{name:e,title:s,isExpanded:r}=t,[n,i]=Q[e];return super.render(`\n      <li class="filters-list__item filter ${r?"":"filter_no-expander"}">\n        <input class="filter__expander" type="checkbox" name="filter-expand" value="${e}" id="${e}">\n        <div class="filter__expander-wrapper">\n          <label class="filter__expander-label" for="${e}">\n            <h2 class="filter__title">${s}</h2>\n          </label>\n        </div>\n        <div class="filter__content">\n          ${this.renderChild("filter",i,{data:t})}\n        </div>\n      </li>\n    `)}}class X extends A{constructor(t){super({...t,root:".filters"})}renderItems({products:t,state:{filterStates:e}}){return console.log(e),Object.entries(Q).map((([s,[r,n,i,a=!0]])=>this.renderChild("filterItems",h,{viewConstructor:K,data:{name:s,title:r,products:t,isExpanded:a,state:e[s]}}))).join("")}render(t){let e="";if(void 0!==t){const{error:s}=t;e=s?"Ошибка загрузки товаров":`<ul class="filters__list filters-list">\n              ${this.renderItems(t)}\n          </ul>`}return super.render((t=>`\n      <div class="filters">\n        ${""!==t?t:e}\n      </div>\n    `))}}class tt extends h{constructor(t){super({...t,viewConstructor:X}),this.handleFiltersChange=()=>{const{filterItems:t}=this.getComponents();if(Array.isArray(t)){const s=t.map((t=>t.getComponent("filter")));s.every((t=>!Array.isArray(t)&&t instanceof F))&&this.emit(e.FILTERS_CHANGE,s)}},this.handleAppLoad=t=>{this.onLoadingEnd(t.detail),queueMicrotask(this.handleFiltersChange)},this.on(e.APP_LOAD,this.handleAppLoad),this.on(e.FILTER_CHANGE,this.handleFiltersChange),this.onLoadingStart()}}class et extends c{constructor(t){super({...t,root:".main"})}render(){return super.render(`\n      <div class="main">\n        <div class="main__container container">\n          <aside class="main__left">\n            ${this.renderChild("filters",tt)}\n          </aside>\n          <div class="main__right">\n            <div class="products">\n              ${this.renderChild("productsHeader",h,{viewConstructor:$})}\n              ${this.renderChild("productsList",G)}\n            </div>\n          </div>\n        </div>\n      </div>\n    `)}}class st extends c{constructor(t){super({...t,root:".alert"})}render(t){return super.render(`\n      <div class="alert">\n        <p>${t?t.message:""}</p>\n      </div>\n    `)}}class rt extends h{constructor(t){super({...t,viewConstructor:st}),this.handleShowAlert=t=>{const e=t.detail;this.update({message:e}),this.getRoot().classList.remove("alert_hide"),this.getRoot().classList.add("alert_show"),setTimeout((()=>{this.getRoot().classList.remove("alert_show"),this.getRoot().classList.add("alert_hide")}),rt.hideDelay)},this.on(e.SHOW_ALERT,this.handleShowAlert)}}rt.hideDelay=3e3;class nt extends c{render(){return super.render(`\n      ${this.renderChild("alert",rt)}\n      ${this.renderChild("header",h,{viewConstructor:x})}\n      ${this.renderChild("main",h,{viewConstructor:et})}\n      ${this.renderChild("footer",h,{viewConstructor:L})}\n    `)}}class it{async load(){const e=await fetch(`${t}/data.json`);if(!e.ok)throw new Error("Data load error!");return await e.json()}}class at{constructor(t){this.key=t}async save(t){window.localStorage.setItem(this.key,JSON.stringify(t))}async load(){const t=window.localStorage.getItem(this.key);return null===t?null:JSON.parse(t)}}class ot extends EventTarget{constructor(){super()}on(t,e){const s=(t=>e=>{if(!function(t){return"detail"in t}(e))throw new TypeError;t(e)})(e);return this.addEventListener(t,s),()=>{this.removeEventListener(t,s)}}emit(t,e){this.dispatchEvent(new CustomEvent(t,{detail:e}))}}new class extends h{constructor(t,s){super({...t,viewConstructor:nt,viewOptions:{root:a(document)(s)}}),this.handleDataLoad=async t=>(this.products=t,this.loadState()),this.handleFiltersChange=t=>{const e=t.detail;this.filterStates=e.reduce(((t,e)=>(t[e.getName()]=e.getState(),t)),{});const s=this.products.filter((t=>e.reduce(((e,s)=>e&&s.check(t)),!0)));var r,n;r=this.filtred,n=s,r.length===n.length&&r.every(((t,e)=>n[e].id===t.id))||(this.filtred=s,this.updateProductsList())},this.handleTryAddToCart=t=>{const s=t.detail,r=this.products.find((t=>t.id===s));void 0===r||this.productInCartIds.includes(r.id)||(3===this.productInCartIds.length?this.emit(e.SHOW_ALERT,"Корзина переполнена! Лимит товаров в корзине: 3."):(this.productInCartIds.push(r.id),this.emit(e.ADD_TO_CART,r.id)))},this.handleChangeSort=t=>{this.sort!==t.detail&&(this.sort=t.detail,this.updateProductsList())},this.handleAppLoad=async(t=null)=>{const s=t?[]:this.filtred;this.emit(e.APP_LOAD,{products:s,state:this.getState(),error:t})},this.handleStateLoad=async t=>{null===t?this.saveState():this.setState(t),this.filtred=[...this.products];const[e,s]=E[this.sort];s.call(null,this.filtred),this.handleAppLoad(null)},this.saveState=async()=>{this.storageService.save(this.getState())},this.productsService=new it,this.storageService=new at("appState"),this.products=[],this.filtred=[],this.productInCartIds=[],this.sort=p.TITLE_ASC,this.filterStates={},this.on(e.FILTERS_CHANGE,this.handleFiltersChange),this.on(e.TRY_ADD_TO_CART,this.handleTryAddToCart),this.on(e.CHANGE_SORT,this.handleChangeSort),window.addEventListener("beforeunload",this.saveState),this.productsService.load().then(this.handleDataLoad).then(this.handleStateLoad).catch((t=>{this.emit(e.SHOW_ALERT,`Ошибка при загрузке данных: ${t.message}`),this.handleAppLoad(t)})),this.getRoot().insertAdjacentHTML("beforeend",this.render()),this.afterRender()}updateProductsList(t=this.filtred){const[s,r]=E[this.sort];r.call(null,this.filtred),this.emit(e.PRODUCTS_LIST_UPDATE,{products:t,state:this.getState()})}getState(){const{productInCartIds:t,sort:e,filterStates:s}=this;return{productInCartIds:t,sort:e,filterStates:s}}setState(t){const{productInCartIds:e,sort:s,filterStates:r}=t;this.productInCartIds=e,this.sort=s,this.filterStates=r}async loadState(){return await this.storageService.load()}}({emmiter:new ot},"#app")})();